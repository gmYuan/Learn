# React之 Fiber原理

Q1 为什么要引入Fiber架构
A:
S1 浏览器是多线程，其中 JS线程和渲染线程是互斥的，当其中一个线程执行时，另一个线程只能挂起等待；
因为 JS线程是可以操作 DOM 的，如果 渲染线程和 JS线程可以 同时工作，那么渲染结果必然是难以预测的

S2 在这样的机制下，若 JS线程长时间地占用了主线程，那么渲染层面的更新就 不得不长时间地等待，造成所谓的“卡顿”

S3 而 Stack Reconciler的一个无解问题，就是JS对 主线程的 超时占用问题

S4.1 栈调和机制下的 Diff算法，是一个同步递归的  深度优先遍历树  的过程
S4.2 这个递归过程是同步的，不可以被打断；当处理相对庞大的虚拟 DOM 树时，JS线程将长时间地霸占主线程，进而导致我们上文中所描述的渲染卡顿/卡死、交互长时间无响应等问题


```js
// 若 A 组件发生了更新，那么栈调和的工作过程是这样的：
// - 对比第 1 层的两个 A，确认节点可复用，继续 Diff 其子组件
// - Diff 到 B 的时候，对比前后的两个 B 节点，发现可复用，于是继续 Diff 其子节点 D、E
// - 待 B树最深层的 Diff 完成、逐层回溯后，再进入 C 节点的 Diff 逻辑......
// - 调和器会重复“父组件调用子组件”的过程，直到最深的一层节点更新完毕，才慢慢向上返回
```

------
Q2 Fiber 是如何解决堵塞问题的
A:
S1 




## 参考文档

01 [React 深入浅出第12章](/)