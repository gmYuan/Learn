# 跨域方法

目录:

1 [预读文档](#1)

2 [跨域前提— 同源策略 + 同源策略原因](#2) 

3 [跨域方法](#3)
 
  - [3.1 JSONP](#3.1)

  - [3.2 CORS](#3.2)


## <span id="1"> 一 预读文档 </span>

1.1 [跨域，你需要知道的全在这里](https://github.com/happylindz/blog/issues/3)

1.2 [前端常见跨域解决方案大全](https://segmentfault.com/a/1190000011145364)

阅读原因: 同源 + 同源策略介绍


2 [跨域，你需要知道的全在这里](https://github.com/happylindz/blog/issues/3)

阅读原因: JSONP实现的可读性代码 + CORS代码


3 [前端跨域整理](https://juejin.im/post/5815f4abbf22ec006893b431)

阅读原因: 后备阅读



## <span id="2">二 跨域前提— 同源策略 + 同源策略原因 </span>

1 Q: 什么是同源

A: 在介绍同源策略前，先明确一下什么是同源

S1 当2个网页的 协议 + 域名 + 端口号都相同时，则这2个网页被认为是 同源的


2 Q: 什么是跨域/同源策略

A: S1 出于安全考虑，浏览器对JS进行了限制，当A网页和 请求的目标B 之间不同源时, 视为 跨域

S2 跨域时，浏览器对JS限制了以下3个方面

S3.1 A 无法读取 B返回的 AJAX响应数据

S3.2 A 无法读取 B网页的 cookie/LocalStorage/IndexDB 等缓存数据

S3.3 A 无法读取  B网页的 DOM和JS对象

需要注意的是:

S4.1 跨域只存在于浏览器端，不存在于安卓/ios/Node.js/python/ java等其它环境

S4.2 跨域请求能发出去，服务端能收到请求并正常返回结果，只是结果被浏览器拦截了


3 Q: 为什么要设置同源策略

A: 主要是为了防止 CSRF(跨站请求伪造)，具体可参考[浅谈CSRF攻击方式](http://www.cnblogs.com/hyddd/archive/2009/04/09/1432744.html)



## <span id="3">三 跨域方法 </span>

### <span id="3.1">3.1 JSONP </span>

1 Q: JSONP的实现原理是什么

A S1 JSONP的实现原理是 浏览器不限制 页面上对 JS等静态文件的跨域请求

S2 所以我们可以利用 script标签，对跨域的数据发起请求

S3 注意，浏览器会自动执行 通过script标签返回 的JS代码


2 Q: JSONP的实现步骤是什么

A S1 前端定义一个 目标函数foo + 发起一个script标签请求，url中含有参数 `..?callback=foo`

S2 后端识别url中的请求参数callback + 返回的文本内容为 `foo(data)`

S3 浏览器获取返回内容后，会自动执行JS语句 + 因为之前已经定义了 foo函数，因此不会报错


3 Q: JSONP的不足

A S1 只能发送get请求，不支持 POST 等其它请求类型

S2 一般只能获取数据， 不能解决 两个页面 或 iframe之间 进行数据通信的问题


### <span id="3.2">3.2 CORS </span>

1 Q: 什么是CORS,实现步骤是什么

A: S1 CORS即 跨域资源共享，是W3C的一个标准，它突破了 AJAX请求的同源限制

S2 实现CORS的步骤是:

S2.1 前端正常发起AJAX请求

S2.2 后端的代码，设置一个响应头: `Access-Control-Allow-Origin`






