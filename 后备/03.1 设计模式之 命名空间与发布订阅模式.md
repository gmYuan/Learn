# 命名空间与发布订阅

目录

1 [预读文档](#1)



2 [命名空间](#2)

 

  - [2.1 命名空间 介绍](#2.1)

  - [2.2 命名空间 使用](#2.2)

3 [发布订阅](#3)

  

## <span id="1"> 一 预读文档 </span>

阅读文档

1 [MDN— JS面向对象简介](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Introduction_to_Object-Oriented_JavaScript)

阅读原因: 命名空间概念的初步介绍，很浅显易懂


2 [JS模式— 第5章 对象创建模式](https://github.com/TooBug/javascript.patterns/blob/master/chapter5.markdown)

阅读原因: 对象相关的各种术语的介绍，其中包括命名空间，非常好




## <span id="2"> 二 命名空间 </span>

### <span id="2.1"> 2.1 命名空间 介绍 </span>

1 Q: 为什么要引入命名空间

A: S0 核心: 防止变量冲突，各模块之间互不干扰(解耦) + 减少全局变量 的数量

S1 一个复杂页面根据功能模块，会引入多个文件，一个JS文件内可能就有多个变量和函数

S2 如果引用的页面内有不同功能相同命名的变量/方法，就有可能功能会覆盖

S3 因此，为了避免模块之间的内部数据互相影响，就需要作用域/内部空间 来封装各模块变量 


2 Q: 什么是 命名空间

A: S0 核心: 创建一个对象 + 数据和函数作为对象内部属性和方法

S1 命名空间 初始化就是一个空对象，我们可以把 原本暴露在全局的变量/函数 都变成对象的内部属性和方法

S2 注意，一般情况下 创建命名空间需要先检测一下 该对象是否已存在，以防止覆盖

S3 子命名空间，就是在对象之内嵌套对象

S4.1 ES6之前，可以用一个IIFE来创建局部作用域

S4.2 ES6后，可以用 {} + let关键字，来形成一个块级作用域


### <span id="2.2"> 2.2 命名空间 使用 </span> 

1 Q: 如何通过命名空间，进行模块间通信

A: S0 入口文件 +命名空间 挂载到 `window.入口文件` 对象上

S1 创建一个入口文件app.js，里面是一个全局对象属性 `window.APP = APP(APP = {})`

S2 同上， 一个模块创建一个命名空间 + 把创建的命名空间挂载到 window.APP 属性上

S3 因为都是 window.APP对象的属性，所以任意模块的命名空间都可以在 全局范围内被访问

S4 当触发事件后，在触发事件函数里 调用其他相关模块内部 对应的响应方法


2 具体代码，可参考[命名空间与模块通信](https://github.com/gmYuan/163-music/commit/08c50389bcf9c38403dc1a264606bdf7781a2ddb)



## <span id="3"> 三 发布订阅 </span>

1 Q: 什么是 发布订阅模式

A: S0 核心: 订阅 某个事件 + 要有分派中心，能接收+监听并发送事件信号 + 订阅事件的接收到信号后，回调处理触发

S1 创建分派事件中心: event-hub.js文件，里面创建一个 `window.eventHub` 全局对象


S2.1 分派中心 要有一个记录本— events哈希: 可订阅的事件名(类型) + 订阅该事件的 模块回调

S2.2 分派中心本来需要记录 订阅事件的模块名，但是模块名记录了也不重要/无作用

       所以直接记录订阅事件的 模块的回调函数，这样当触发事件后，就直接调用回调函数

       相当于直接记录 用户地址而非 用户名即可


S3 分派中心 要能接受 模块的订阅— on()方法: 

     参数包括 模块要订阅的 事件名 +　获取到分派数据后的处理/回调动作

     功能是 初始化记录事件名 + 把回调函数关联到 事件key中


S4 分派中心 要能接受事件的 触发和传输— emit()方法: 

     参数包括 该模块触发的 事件名 + 希望通过分派中心传输的 数据

     功能是 传输事件— 遍历调用 对应记录事件的 回调函数（传入 触发事件时传出的data）












     