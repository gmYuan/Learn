# 异步编程之 同步与异步

## 前言

最近学习了异步编程的相关知识，所以对其做一个小结

这部分是异步的基础知识介绍。


目录:

1 [为什么要引入异步](#1)

  - [JS单线程的原因和缺点](#1.1)

  - [同步/异步 与 堵塞/非堵塞](#1.2)

2 [异步的实现](#2)

3 [常见的异步操作](#3)


## <span id="1">一 为什么要引入异步</span>

### <span id="1.1">1.1 JS单线程的原因和缺点</span>

1 JS是单线程的，也就是说线程栈/堆中的任务  执行完前一个后，才能执行下一个

2 JS设计成单线程的原因: 是因为JS的主要用途 是与用户互动，以及操作DOM

> 假定JavaScript同时有两个线程，一个线程在某个DOM节点上添加内容，另一个线程删除了这个节点

> 这时浏览器就无法确定 应该以哪个线程为准

> 所以，为了避免复杂性，JavaScript设计成了单线程模式

3 单线程的缺点: 

S1 程序运行效率较低: 所有任务需要排队，前一个任务结束，才会执行后一个任务。如果前一个任务耗时很长，后一个任务就要一直堵塞，

而一些IO操作/网络请求等任务 的耗时时间往往是无法预估的

S2 执行耗时任务时，单线程会导致 浏览器无法 继续渲染页面/响应用户行为，这是不可接受的


### <span id="1.2">1.2 同步/异步 与 堵塞/非堵塞</span>

这部分直接引用了知乎的回答，具体见: [怎样理解阻塞非阻塞与同步异步的区别](https://www.zhihu.com/question/19732473)

具体摘录如下:

1 同步和异步关注的是 `数据结果的 通信机制`

S1 同步，是在发出一个`调用`后，在得到结果之前，该调用不会返回，但是一旦调用返回，就得到返回值了

换句话说，就是 `调用者要主动等待 调用的结果`


S2 异步，是在 调用在发出之后，这个调用就直接返回了，所以没有返回结果

换句话说，`调用者不用等待结果，被调用者通过状态、回调等方式来通知调用者 结果`


举个例子:

你打电话问书店老板有没有《分布式系统》这本书,

S1 如果是同步通信机制，书店老板会说，你稍等，”我查一下"，然后开始查，等查好了（可能是5秒，也可能是一天）告诉你结果（返回结果）

S2 而异步通信机制，书店老板告诉你 我查一下，查好了打电话给你，然后直接挂电话了（不返回结果）,然后查好了，他会主动打电话给你


2 阻塞和非阻塞关注的是 `程序在等待调用结果时的状态`

S1 阻塞调用是指调用结果返回之前，当前线程会被挂起。调用线程只有在得到结果之后才会返回

S2 非阻塞调用指在不能立刻得到结果之前，该调用不会阻塞当前线程


还是上面的例子，你打电话问书店老板有没有《分布式系统》这本书，

S1 如果是阻塞式调用，你会一直把自己“挂起”，直到得到这本书有没有的结果

S2 如果是非阻塞式调用，你不管老板有没有告诉你，你自己先一边去玩了,当然你也要偶尔过几分钟check一下老板有没有返回结果。


3 所以综上，同步/异步指的是 `在调用返回后，是否立刻就能得到调用结果`; 堵塞/非堵塞 指的是 返回调用结果前 `调用者的状态`

可以简单理解为:

同步 + 堵塞:  调用方A 一直等着 被调用方B 调用结果 + A在得到结果之前 其他任何事都不做
 
同步+ 不堵塞: 调用方A 一直等着 被调用方B 调用结果 + A在得到结果之前 继续做其他事

异步+ 不堵塞: 调用方A 不等着 调用结果 + A在得到结果之前 继续做其他事



## <span id="2">二 异步的实现</span>

1 Q: 同步/异步程序的根本区别是什么

A S1: 区别在于，是否`等待程序运行结果`

S2 同步程序 会等待调用后的返回结果。                   比如: A让黄牛去买票，然后一直站着等买票结果

S3 异步程序 不会等待调用结果，直接进行下一步(段)程序。 比如: A让黄牛去买票，然后不等买票结果就直接走了


2 Q: 什么是回调(callback)

A: S1 回调函数: 回调函数是拿到异步程序执行结果的一种方式，当然它也可以拿到同步结果

满足某种条件(通常是 返回某种操作的结果)才会执行的函数，叫做回调函数


S2 实现异步的方式有很多，JS是通过 `回调函数callback` 来实现异步的

S3 JS异步实现 步骤:

S1 把回调函数作为参数传递给 异步执行函数

S2 当有结果返回之后, 再自动执行callback



## <span id="3">三 常见的异步操作</span>

1 开发中比较常用的异步操作有：

S1 网络请求: 如ajax / http.get

S2 IO操作:   如readFile / readdir

S3 定时函数: 如setTimeout / setInterval


以上可参考

[01 JS运行机制详解—再谈Event Loop](http://www.ruanyifeng.com/blog/2014/10/event-loop.html)

[02 深入理解JS异步 1.1-1.2](https://github.com/wangfupeng1988/js-async-tutorial)




