# 面向对象之 new的模拟实现

目录

1 [预读文档](#1)

2 [new关键字 的作用](#2)

3 [new的过程 与 模拟实现](#3)



## <span id="1"> 1 预读文档</span>

1 阅读文档有:

01 [JS深入之 new的模拟实现](https://github.com/mqyqingfeng/Blog/issues/13)

阅读原因: 模拟 new的实现过程


02 [深度解析new原理及模拟实现 ](https://github.com/yygmind/blog/issues/24)

阅读原因: 模拟 new的实现过程 + 思考题很好



## <span id="2"> 2 new关键字 的作用 </span>

1 Q: new关键字的 作用是什么

A: 

S1 作用是 返回一个对象，这个对象 可以访问构造函数 & 构造函数原型中的 属性

代码举例:

```js

function Person(name, age){
  this.name = name
  this.age = age
}

Person.prototype.sayname = function(){
  console.log("I'm " + this.name)
}

let person = new Person('klay', 18)

console.log(person.age)   // 18
person.sayname()          // I'm klay

```



## <span id="3"> 3 new的过程 与 模拟实现 </span>

1 Q: new的过程是什么

A: 

S1 创建一个新的空对象

S2 调用构造函数执行，内部的this指向这个新对象

S3 把这个新对象的proto指向 构造函数的prototype

S4 如果构造函数有返回对象，就返回这个对象， 否则默认返回 新对象


2 Q: 写出一个函数，模拟new的实现/功能

A: 

思路是:

S1 创建以后要返回的新对象

S2 因为这个模拟函数，传入的第一个值是构造函数，所以可以从参数arguments中获取构造函数

S3 调用构造函数执行，内部的this指向这个新对象 + 传入剩余的参数

S4 把这个新对象的proto指向 构造函数的prototype

S5 判断构造函数是否有返回对象，有则返回这个对象，没有则返回 新对象

具体代码见下:

```js
function likeNew(){
  let obj = {}
  let Factory = [].shift.call(arguments)  // 获取arguments的第一个参数并返回，原数组也会改变

  let ret = Factory.apply(obj, arguments)    // 调用构造函数，并传入剩余参数，注意call和apply的参数区别
  obj.__proto__ = Factory.prototype

  return ret instanceof Object ? ret: obj   // 构造函数执行后的返回值 是对象就返回
}


// 测试用例1 

function Person(name, age){
  this.name = name
  this.age = age
}

Person.prototype.sayname = function(){
  console.log("I'm " + this.name)
}

let person = likeNew(Person, 'klay', 18)

console.log(person.age)   // 18
person.sayname()          // I'm klay

```
